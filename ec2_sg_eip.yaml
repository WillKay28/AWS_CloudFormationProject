---
Parameters:
	SecurityGroupDescription:
		Description: Security Group Description
		Type: String

Resources:
	# an EC2 t2.micro Instance
	MyInstance:
		Type: AWS::EC2::Instance
		Properties:
			AvailabilityZone: us-east-1a
			ImageId: ami-a4c7edb2
			InstanceType: t2.micro
			SecurityGroups:
				- !Ref SSHSecurityGroup
				- !Ref ServerSecurityGroup
	
	# an Elastic IP for the EC2 Instance
	MyEIP:
		Type: AWS::EC2::EIP
		Properties:
			InstanceId: !Ref MyInstance

	# an EC2 Security Group for SSH connection - Ingress is for inbound traffic
	SSHSecurityGroup:
		Type: AWS::EC2::SecurityGroup
		Properties:
			GroupDescription: Enable SSH access via port 22
			SecurityGroupIngress:
				- CidrIp: 0.0.0.0/0
				  FromPort: 22
				  IpProtocol: tcp
				  ToPort: 22

	# an EC2 Security Group for Server
	ServerSecurityGroup:
		Type: AWS::EC2::SecurityGroup
		Properties:
			GroupDescription: !Ref SecurityGroupDescription
			SecurityGroupIngress:
				- IpProtocol: tcp
				  FromPort: 80
				  ToPort: 80
				  CidrIp: 0.0.0.0/0
				- IpProtocol: tcp
				  FromPort: 22
				  ToPort: 22
				  CidrIp: 192.168.1.1/32

Outputs:
	ElasticIP:
		Description: Elastic IP Values
		Value: !Ref MyEIP


